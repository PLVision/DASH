
# DASH configuration specification

In general a DASH config consists of such entries:

```
DASH_OBJECT_TYPE:
    object_name: NUMBER_OF_OBJECTS
        attribute_name: CONST_OR_GENERATOR
```

Where,
* `DASH_OBJECT_TYPE` - Can be **DASH_VNET**, **DASH_VIP**, **DASH_ENI**, etc.
* `object_name` - Name of the object
* `NUMBER_OF_OBJECTS` - Number of such objects to create
* `attribute_name` - Specific attributes of every object. Depend on `DASH_OBJECT_TYPE`.
* `CONST_OR_GENERATOR` - The value of the attribute. Could be a constant value or a sequence generator expression.

If `NUMBER_OF_OBJECTS` is greated than the number of values generated by the sequence generator - after reaching the last value generator must produce values from the start again.

If number of values generated by the sequence generator is greater than `NUMBER_OF_OBJECTS` - only first` NUMBER_OF_OBJECTS` values of the sequence generator should be used.

## Sequence generator

For scaling purposes sequence generator could be used for creating big number of objects. It produces a range of values according to the given attributes.

### Sequence generator attributes:

* `count` - The number of entries (default is 1)
* `type`  - Type of the entry [INT, IP, MAC, OID] (default is INT)
* `start` - The first entry (no default values)
* `step`  - Increment step (default values depend on the type: INT - 1, IP - "0.0.0.1", MAC - "00:00:00:00:00:01", no default for OID)
* `delay` - Delay incremet for `delay` iterations (default is 1, which means increment at every iteration)
* `list`  - Use this specific list of values instead of the generated values. If this attribute is present `start`, `step`, `delay` must be ignored. `count` and `type` still will be used.

### Sequence generator expresions examples:

#### Integers

```
{ count: 4, type: INT, start: 100, step: 10 } => 100, 110, 120, 130
{ count: 4, type: INT, start: 100, step: 5 } => 100, 105, 110, 115
{ count: 4, type: INT, start: 100, step: 10, delay: 2} => 100, 100, 105, 105
{ count: 4, start: 100 } => 100, 101, 102, 103
{ start: 100 } => 100
```

#### IP-addresses and IP-prefixes

```
{ count: 4, type: IP, start: "10.0.0.1", step: "0.0.0.1" } => "10.0.0.1", "10.0.0.2", "10.0.0.3", "10.0.0.4"
{ count: 4, type: IP, start: "10.0.0.1", step: "0.0.1.0" } => "10.0.0.1", "10.0.1.1", "10.0.2.1", "10.0.3.1"
{ count: 4, type: IP, start: "10.0.0.1", step: "0.0.1.0", delay: 2 } => "10.0.0.1", "10.0.0.1", "10.0.1.1", "10.0.1.1"
{ count: 4, type: IP, start: "10.0.0.1" } => "10.0.0.1", "10.0.0.2", "10.0.0.3", "10.0.0.4"
{ type: IP, start: "10.0.0.1" } => "10.0.0.1"

{ count: 4, type: IP, start: "10.0.0.0/24", step: "0.0.1.0" } => "10.0.0.0/24", "10.0.1.0/24", "10.0.2.0/24", "10.0.3.0/24"
{ count: 4, type: IP, start: "10.0.0.0/24", step: "0.1.1.0" } => "10.0.0.0/24", "10.1.1.0/24", "10.2.2.0/24", "10.3.3.0/24"
{ count: 4, type: IP, start: "10.0.0.0/24", step: "0.1.1.0", delay: 2 } => "10.0.0.0/24", "10.0.0.0/24", "10.2.2.0/24", "10.2.2.0/24"
{ type: IP, start: "10.0.0.1/24" } => "10.0.0.1/24"
```

#### MAC-addresses

```
{ count: 4, type: MAC, start: "00:CC:CC:CC:CC:00", step: "00:00:00:00:00:01" } => "00:CC:CC:CC:CC:00", "00:CC:CC:CC:CC:01", "00:CC:CC:CC:CC:02", "00:CC:CC:CC:CC:03"
{ count: 4, type: MAC, start: "00:CC:CC:CC:CC:00", step: "00:00:00:00:00:10" } => "00:CC:CC:CC:CC:00", "00:CC:CC:CC:CC:10", "00:CC:CC:CC:CC:20", "00:CC:CC:CC:CC:30"
{ count: 4, type: MAC, start: "00:CC:CC:CC:CC:00", step: "00:00:00:00:00:10", delay: 2 } => "00:CC:CC:CC:CC:00", "00:CC:CC:CC:CC:00", "00:CC:CC:CC:CC:10", "00:CC:CC:CC:CC:10"
{ count: 4, type: MAC, start: "00:CC:CC:CC:CC:00" } => "00:CC:CC:CC:CC:00", "00:CC:CC:CC:CC:01", "00:CC:CC:CC:CC:02", "00:CC:CC:CC:CC:03"
{ type: MAC, start: "00:CC:CC:CC:CC:00" } => "00:CC:CC:CC:CC:00"
```

#### Object IDs

```
{ count: 4, type: OID, start: "DASH_VNET#vnet#0", step: 1 } => "$DASH_VNET#vnet#0", "$DASH_VNET#vnet#1", "$DASH_VNET#vnet#2", "$DASH_VNET#vnet#3"
{ count: 4, type: OID, start: "DASH_VNET#vnet#0", step: 2 } => "$DASH_VNET#vnet#0", "$DASH_VNET#vnet#2", "$DASH_VNET#vnet#4", "$DASH_VNET#vnet#6"
{ count: 4, type: OID, start: "DASH_VNET#vnet#0", step: 2, delay: 2} => "$DASH_VNET#vnet#0", "$DASH_VNET#vnet#0", "$DASH_VNET#vnet#2", "$DASH_VNET#vnet#2"
{ count: 4, type: OID, start: "DASH_VNET#vnet#0"} => "$DASH_VNET#vnet#0", "$DASH_VNET#vnet#1", "$DASH_VNET#vnet#2", "$DASH_VNET#vnet#3"
{ type: OID, start: "DASH_VNET#vnet#0"} => "$DASH_VNET#vnet#0"
```

#### Lists

```
{ count: 4, type: INT, start: 100, step: 10, list: [3, 5, 7, 9] } => 3, 5, 7, 9
{ count: 4, type: INT, list: [3, 5, 7, 9] } => 3, 5, 7, 9
{ count: 2, type: INT, list: [3, 5, 7, 9] } => 3, 5
{ count: 6, type: INT, list: [3, 5, 7, 9] } => 3, 5, 7, 9, 3, 5
```

# Example of generator output using scale configuration

Here is an example of DASH_OUTBOUND_ROUTING scale configuration using DASH config

### Input:

```
NUMBER_OF_ORE:  5
NUMBER_OF_ENI:  4
NUMBER_OF_DST:  3
NUMBER_OF_VNET: 10

DASH_OUTBOUND_ROUTING:
    ore: NUMBER_OF_ORE
        SWITCH_ID: $SWITCH_ID
        ENI_ID: { count: NUMBER_OF_ENI, type: OID, start: "DASH_ENI#eni#0", delay: NUMBER_OF_DST }
        DESTINATION: { count: NUMBER_OF_DST, type: IP, start: "10.1.0.0/24", step: "0.0.1.0" }
        ACTION: ROUTE_VNET
        DST_VNET_ID: { count: NUMBER_OF_VNET, type: OID, start: "DASH_VNET#vnet#0" }
```

### Output:

```json
  {
    "name": "DASH_OUTBOUND_ROUTING#ore#0",
    "op": "create",
    "type": "SAI_OBJECT_TYPE_OUTBOUND_ROUTING_ENTRY",
    "key": {
      "switch_id": "$SWITCH_ID",
      "eni_id": "$DASH_ENI#eni#0",
      "destination": "10.1.0.0/24"
    },
    "attributes": [
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_ACTION", "SAI_OUTBOUND_ROUTING_ENTRY_ACTION_ROUTE_VNET",
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_DST_VNET_ID", "$DASH_VNET#vnet#0"
    ]
  },
  {
    "name": "DASH_OUTBOUND_ROUTING#ore#1",
    "op": "create",
    "type": "SAI_OBJECT_TYPE_OUTBOUND_ROUTING_ENTRY",
    "key": {
      "switch_id": "$SWITCH_ID",
      "eni_id": "$DASH_ENI#eni#0",
      "destination": "10.1.1.0/24"
    },
    "attributes": [
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_ACTION", "SAI_OUTBOUND_ROUTING_ENTRY_ACTION_ROUTE_VNET",
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_DST_VNET_ID", "$DASH_VNET#vnet#1"
    ]
  },
  {
    "name": "DASH_OUTBOUND_ROUTING#ore#2",
    "op": "create",
    "type": "SAI_OBJECT_TYPE_OUTBOUND_ROUTING_ENTRY",
    "key": {
      "switch_id": "$SWITCH_ID",
      "eni_id": "$DASH_ENI#eni#0",
      "destination": "10.1.2.0/24"
    },
    "attributes": [
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_ACTION", "SAI_OUTBOUND_ROUTING_ENTRY_ACTION_ROUTE_VNET",
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_DST_VNET_ID", "$DASH_VNET#vnet#2"
    ]
  },
  {
    "name": "DASH_OUTBOUND_ROUTING#ore#3",
    "op": "create",
    "type": "SAI_OBJECT_TYPE_OUTBOUND_ROUTING_ENTRY",
    "key": {
      "switch_id": "$SWITCH_ID",
      "eni_id": "$DASH_ENI#eni#1",
      "destination": "10.0.1.0/24"
    },
    "attributes": [
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_ACTION", "SAI_OUTBOUND_ROUTING_ENTRY_ACTION_ROUTE_VNET",
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_DST_VNET_ID", "$DASH_VNET#vnet#3"
    ]
  },
  {
    "name": "DASH_OUTBOUND_ROUTING#ore#4",
    "op": "create",
    "type": "SAI_OBJECT_TYPE_OUTBOUND_ROUTING_ENTRY",
    "key": {
      "switch_id": "$SWITCH_ID",
      "eni_id": "$DASH_ENI#eni#1",
      "destination": "10.1.1.0/24"
    },
    "attributes": [
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_ACTION", "SAI_OUTBOUND_ROUTING_ENTRY_ACTION_ROUTE_VNET",
      "SAI_OUTBOUND_ROUTING_ENTRY_ATTR_DST_VNET_ID", "$DASH_VNET#vnet#4"
    ]
  }
```

# Outbound DASH config example

```
NUMBER_OF_VIP: 3
NUMBER_OF_DLE: 3
NUMBER_OF_IN_ACL_GROUP: 10
NUMBER_OF_OUT_ACL_GROUP: 10
NUMBER_OF_VNET: 50
NUMBER_OF_ENI: 10
NUMBER_OF_EAM: NUMBER_OF_ENI * 2
NUMBER_OF_ORE: 5
NUMBER_OF_DST: 10
NUMBER_OF_OCPE: 5

DASH_VIP:
    vpe: NUMBER_OF_VIP
        SWITCH_ID: $SWITCH_ID
        IPv4: { count: NUMBER_OF_VIP, type: IP, start: "172.1.0.100", step: "0.1.0.0" }

DASH_DIRECTION_LOOKUP:
    dle: NUMBER_OF_DLE
        SWITCH_ID: $SWITCH_ID
        VNI: { count: NUMBER_OF_DLE, start: 100, step: 100 }
        ACTION: SET_OUTBOUND_DIRECTION

DASH_ACL_GROUP:
    in_acl_group_id: NUMBER_OF_IN_ACL_GROUP
        ADDR_FAMILY: IPv4
    out_acl_group_id: NUMBER_OF_OUT_ACL_GROUP
        ADDR_FAMILY: IPv4

DASH_VNET:
    vnet: NUMBER_OF_VNET
        VNI: { count: NUMBER_OF_VNET, start: 1000, step: 10 }

DASH_ENI:
    eni: NUMBER_OF_ENI
        ACL_GROUP:
            INBOUND:
                STAGE1: { type: OID, list: "DASH_ACL_GROUP#in_acl_group_id#0" }
                STAGE2: { type: OID, list: "DASH_ACL_GROUP#in_acl_group_id#0" }
                STAGE3: { type: OID, list: "DASH_ACL_GROUP#in_acl_group_id#0" }
                STAGE4: { type: OID, list: "DASH_ACL_GROUP#in_acl_group_id#0" }
                STAGE5: { type: OID, list: "DASH_ACL_GROUP#in_acl_group_id#0" }
            OUTBOUND:
                STAGE1: 0
                STAGE2: 0
                STAGE3: 0
                STAGE4: 0
                STAGE5: 0
        ADMIN_STATE: True
        CPS: 10000
        FLOWS: 10000
        PPS: 100000
        VM_UNDERLAY_DIP: { count: NUMBER_OF_ENI, type: IP, start: "172.16.1.0", step: "0.0.1.0" }
        VM_VNI: { count: NUMBER_OF_ENI, start: 50 }
        VNET_ID: { count: NUMBER_OF_ENI, type: OID, start: "DASH_VNET#vnet#0" }

DASH_ENI_ETHER_ADDRESS_MAP:
    eam: NUMBER_OF_EAM
        SWITCH_ID: $SWITCH_ID
        MAC: { count: NUMBER_OF_EAM, type: MAC: start: "00:CC:CC:CC:00:00" }
        ENI_ID: { count: NUMBER_OF_ENI, type: OID, start: "DASH_ENI#eni#0" }

DASH_OUTBOUND_ROUTING:
    ore: NUMBER_OF_ORE
        SWITCH_ID: $SWITCH_ID
        ENI_ID: { count: NUMBER_OF_ENI, type: OID, start: "DASH_ENI#eni#0", delay: NUMBER_OF_DST }
        DESTINATION: { count: NUMBER_OF_DST, type: IP, start: "10.1.0.0/24", step: "0.0.1.0" }
        ACTION: ROUTE_VNET
        DST_VNET_ID: { count: NUMBER_OF_VNET, type: OID, start: "DASH_VNET#vnet#0" }

DASH_OUTBOUND_CA_TO_PA:
    ocpe: NUMBER_OF_OCPE
        SWITCH_ID: $SWITCH_ID
        DST_VNET_ID:  { count: NUMBER_OF_VNET, type: OID, start: "DASH_VNET#vnet#0" }
        DIP: { count: NUMBER_OF_OCPE, type: IP, start: "10.1.2.50", step: "0.0.1.0" }
        UNDERLAY_DIP: { count: NUMBER_OF_OCPE, type: IP, start: "172.16.1.20", step: "0.0.1.0" }
        OVERLAY_DMAC: { count: NUMBER_OF_OCPE, type: MAC: start: "00:DD:DD:DD:00:00" }
        USE_DST_VNET_VNI: True
```

